<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VonMesser Collection - Art Leads Culture</title>
    <meta name="description" content="A carefully curated assembly of contemporary and classical works exploring the intersection of traditional artistry and modern expression.">
    <meta name="keywords" content="art collection, contemporary art, classical art, curated collection, VonMesser, art gallery">
    <meta property="og:title" content="VonMesser Collection - Art Leads Culture">
    <meta property="og:description" content="A carefully curated assembly of contemporary and classical works exploring the intersection of traditional artistry and modern expression.">
    <meta property="og:image" content="https://vonmesser.xyz/social-preview-square.png">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9IiNmZmZmZmYiLz4KICA8ZyBmaWxsPSIjMzMzIj4KICAgIDxwb2x5Z29uIHBvaW50cz0iOCwyIDEwLDIgMTMsOSAxNiwyIDE4LDIgMTQsMTIgMTEsMTIiLz4KICAgIDxwb2x5Z29uIHBvaW50cz0iMTksMiAyMSwyIDIzLDcgMjUsMiAyNywyIDI3LDEyIDI1LDEyIDI1LDUgMjMsOSAyMSw5IDIwLDUgMjAsMTIgMTksMTIiLz4KICA8L2c+CiAgPHRleHQgeD0iMTYiIHk9IjI3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjMzMzIiBzdHlsZT0iZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogNXB4OyBmb250LXdlaWdodDogNDAwOyBsZXR0ZXItc3BhY2luZzogMC41cHg7Ij5WTTwvdGV4dD4KPC9zdmc+Cg==">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: #fafafa; color: #2c2c2c; line-height: 1.6; overflow-x: hidden; }
        
        /* Layout */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 40px; }
        header { background: rgba(255,255,255,0.95); position: fixed; width: 100%; top: 0; z-index: 1000; border-bottom: 1px solid #f0f0f0; box-shadow: 0 2px 20px rgba(0,0,0,0.08); backdrop-filter: blur(10px); }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 25px 0; min-height: 80px; }
        main { padding: 40px 0 120px; }
        
        /* Typography */
        .tagline { font-size: clamp(3rem, 8vw, 7rem); font-weight: 900; color: #1f2937; text-transform: uppercase; letter-spacing: 0.05em; line-height: 0.9; font-family: Impact, 'Arial Black', sans-serif; }
        .uppercase { text-transform: uppercase; letter-spacing: 1px; }
        
        /* Navigation */
        .nav-links { display: flex; list-style: none; gap: 50px; align-items: center; }
        .nav-links a { text-decoration: none; color: #6b7280; font-size: 16px; transition: color 0.3s; }
        .nav-links a:hover { color: #1f2937; }
        
        /* Dropdown */
        .dropdown { position: relative; }
        .dropdown-toggle::after { content: ' ‚ñº'; font-size: 10px; margin-left: 5px; }
        .dropdown-menu { position: absolute; top: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); min-width: 200px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s; list-style: none; padding: 8px 0; margin: 8px 0 0 0; }
        .dropdown:hover .dropdown-menu { opacity: 1; visibility: visible; transform: translateY(0); }
        .dropdown-menu a { display: block; padding: 12px 20px; color: #4b5563; font-size: 13px; transition: all 0.3s; }
        .dropdown-menu a:hover { background: #f9fafb; color: #1f2937; }
        
        /* Gallery */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 20px; }
        .artwork-card { cursor: pointer; position: relative; opacity: 0; transform: translateY(30px); transition: all 0.4s; border-radius: 8px; overflow: hidden; background: #ffffff; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
        .artwork-card.animate-in { opacity: 1; transform: translateY(0); }
        .artwork-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.12); }
        .artwork-image { width: 100%; background: #f8f8f8; overflow: hidden; position: relative; }
        .artwork-image img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        .artwork-image.landscape { aspect-ratio: 4/3; }
        .artwork-image.portrait { aspect-ratio: 3/4; }
        .artwork-image.square { aspect-ratio: 1/1; }
        .artwork-image.panoramic { aspect-ratio: 16/9; }
        .artwork-info { padding: 20px; }
        .artwork-title { font-size: 13px; font-weight: 500; color: #1f2937; margin-bottom: 8px; }
        .artwork-details { font-size: 11px; color: #6b7280; line-height: 1.4; }
        .artwork-artist { color: #4b5563; margin-bottom: 3px; }
        .artwork-price { margin-top: 8px; color: #374151; font-weight: 500; }
        
        /* Controls */
        .gallery-controls { display: flex; align-items: center; gap: 30px; padding: 20px 30px; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid rgba(240,240,240,0.8); margin-bottom: 50px; }
        .search-input { padding: 12px 16px 12px 40px; border: 1px solid #e5e7eb; background: #fff; font-size: 13px; width: 240px; transition: all 0.3s; border-radius: 8px; }
        .search-input:focus { outline: none; border-color: #1f2937; box-shadow: 0 0 0 3px rgba(31,41,55,0.1); }
        .filter-select { padding: 12px 16px; border: 1px solid #e5e7eb; background: #fff; font-size: 11px; font-weight: 500; cursor: pointer; min-width: 120px; border-radius: 8px; color: #4b5563; }
        
        /* Forms */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 12px; color: #4b5563; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #d1d5db; background: #f9fafb; font-size: 14px; border-radius: 6px; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #1f2937; background: #fff; box-shadow: 0 0 0 3px rgba(31,41,55,0.1); }
        
        /* Buttons */
        .btn { padding: 12px 24px; border: 1px solid #1f2937; background: #fff; color: #1f2937; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.3s; width: 100%; border-radius: 6px; }
        .btn:hover { background: #1f2937; color: #fff; box-shadow: 0 4px 12px rgba(31,41,55,0.2); }
        .btn-small { padding: 6px 12px; font-size: 10px; width: auto; }
        .btn-danger { border-color: #e74c3c; color: #e74c3c; }
        .btn-danger:hover { background: #e74c3c; }
        
        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); backdrop-filter: blur(8px); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 40px; }
        .modal.show { display: flex; }
        .modal-content { background: #fff; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); animation: modalSlideIn 0.3s; }
        @keyframes modalSlideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .close-modal { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.9); border: none; padding: 15px; cursor: pointer; font-size: 18px; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .close-modal:hover { background: rgba(255,255,255,1); transform: scale(1.1); }
        
        /* Admin */
        .admin-trigger { position: fixed; bottom: 30px; right: 30px; width: 20px; height: 20px; cursor: pointer; z-index: 999; opacity: 0.3; transition: all 0.3s; }
        .admin-trigger:hover { opacity: 0.8; transform: scale(1.2); }
        .admin-panel { position: fixed; top: 0; right: -420px; width: 400px; height: 100vh; background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(253,253,253,0.95) 100%); backdrop-filter: blur(20px); border-left: 1px solid rgba(240,240,240,0.8); z-index: 2000; transition: right 0.3s; overflow-y: auto; padding: 20px; box-shadow: -10px 0 40px rgba(0,0,0,0.12); }
        .admin-panel.open { right: 0; }
        .admin-controls { position: absolute; top: 10px; right: 10px; opacity: 0; transition: opacity 0.3s; display: flex; gap: 5px; }
        .artwork-card:hover .admin-controls { opacity: 1; }
        .admin-btn { background: rgba(255,255,255,0.9); border: 1px solid #ddd; padding: 6px 8px; cursor: pointer; font-size: 12px; border-radius: 3px; transition: all 0.2s; min-width: 28px; text-align: center; }
        .admin-btn:hover { background: #333; color: white; border-color: #333; }
        
        /* Sections */
        .hero-tagline { margin-top: 120px; padding: 40px 0 30px; text-align: center; }
        .about-section, .contact-section { border-top: 1px solid #e5e7eb; padding: 80px 0; background: #fafafa; }
        .about-content, .contact-content { max-width: 700px; margin: 0 auto; text-align: center; }
        footer { border-top: 1px solid #e5e7eb; padding: 80px 0; text-align: center; background: #f8f8f8; }
        
        /* Articles */
        .article-card { background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 24px rgba(0,0,0,0.08); transition: all 0.4s; cursor: pointer; }
        .article-header { padding: 30px; border-bottom: 1px solid #f0f0f0; }
        .article-meta { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .author-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #f0f0f0; }
        .author-info h4 { font-size: 14px; font-weight: 500; color: #1f2937; margin-bottom: 2px; }
        .article-title { font-size: 20px; font-weight: 500; color: #1f2937; line-height: 1.3; margin-bottom: 15px; }
        .article-excerpt { font-size: 14px; color: #6b7280; line-height: 1.6; margin-bottom: 20px; }
        .article-stats { display: flex; justify-content: space-between; font-size: 11px; color: #9ca3af; }
        
        /* Editor */
        .rich-editor { border: 1px solid #e5e7eb; border-radius: 8px; min-height: 400px; background: #fff; }
        .editor-toolbar { padding: 15px 20px; border-bottom: 1px solid #f0f0f0; display: flex; gap: 10px; flex-wrap: wrap; }
        .editor-btn { padding: 8px 12px; border: 1px solid #e5e7eb; background: #fff; color: #4b5563; font-size: 12px; cursor: pointer; border-radius: 6px; transition: all 0.3s; }
        .editor-btn:hover { border-color: #333; color: #333; }
        .editor-content { padding: 20px; min-height: 300px; outline: none; font-size: 16px; line-height: 1.6; color: #374151; }
        
        /* FAB */
        .fab-write { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #1f2937; color: #fff; border: none; border-radius: 50%; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 20px rgba(31,41,55,0.3); transition: all 0.3s; z-index: 1000; }
        .fab-write:hover { transform: scale(1.1); box-shadow: 0 8px 30px rgba(31,41,55,0.4); }
        
        /* Mobile */
        @media (max-width: 768px) {
            .container { padding: 0 20px; }
            .nav-links { gap: 25px; }
            .nav-links a { font-size: 13px; }
            nav { padding: 20px 0; min-height: 70px; }
            .gallery-grid { grid-template-columns: 1fr; gap: 20px; }
            .admin-panel { width: 100%; right: -100%; }
            .gallery-controls { flex-direction: column; gap: 15px; padding: 20px; }
            .search-input { width: 100%; }
            .filter-group { width: 100%; justify-content: space-between; gap: 8px; }
            .filter-select { flex: 1; min-width: auto; }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="#" class="logo">
                <svg width="102" height="38" viewBox="0 0 85 32" xmlns="http://www.w3.org/2000/svg">
                    <g fill="#333"><polygon points="24,3 27,3 32,17 35,3 38,3 31.5,19 28.5,19"/><polygon points="40,3 43,3 46,14 49,3 52,3 52,19 49.5,19 49.5,7 47.5,16 44.5,16 42.5,7 42.5,19 40,19"/></g>
                    <text x="42.5" y="29" text-anchor="middle" fill="#333" style="font-family: -apple-system, sans-serif; font-size: 6px; font-weight: 400; letter-spacing: 1.8px;">VONMESSER</text>
                </svg>
            </a>
            <ul class="nav-links">
                <li><a href="#" onclick="returnToMain()" class="uppercase">Physical Collection</a></li>
                <li><a href="https://linktr.ee/flexasaurusrex" target="_blank" class="uppercase">Digital Collection</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle uppercase">Guest Curators</a>
                    <ul class="dropdown-menu">
                        <li><a href="#" onclick="showFeaturedCurator()">Featured Curator</a></li>
                        <li><a href="#" onclick="showAllCurators()">Browse All Curators</a></li>
                        <li><a href="#" onclick="showCuratorApplication()">Apply to Curate</a></li>
                        <li><a href="#" onclick="toggleCuratorAuth()">Curator Login</a></li>
                    </ul>
                </li>
                <li><a href="#" onclick="showCuratorsCorner()" class="uppercase">Curators Corner</a></li>
                <li><a href="#" onclick="scrollToSection('about')" class="uppercase">About</a></li>
                <li><a href="#" onclick="scrollToSection('contact')" class="uppercase">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero-tagline">
        <div class="container">
            <h1 class="tagline">Art Leads Culture</h1>
        </div>
    </section>

    <div class="admin-trigger" onclick="toggleAdmin()">
        <svg viewBox="0 0 20 20"><polygon points="10,2 18,10 10,18 2,10" fill="#333"/></svg>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h3 class="uppercase" id="panelTitle">Admin Panel</h3>
            <button class="close-modal" onclick="toggleAdmin()" style="position: static; width: 30px; height: 30px; padding: 0;">√ó</button>
        </div>
        
        <div id="loginForm" style="padding: 30px; text-align: center;">
            <h3 class="uppercase" style="font-size: 14px; margin-bottom: 30px;">Admin Login</h3>
            <div class="form-group">
                <label for="loginEmail" class="uppercase">Email</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label for="loginPassword" class="uppercase">Password</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button class="btn uppercase" onclick="login()">Login</button>
        </div>

        <div id="adminContent" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e0e0e0; margin-bottom: 20px; background: #f8f8f8;">
                <span id="userEmail" style="font-size: 12px; color: #666;"></span>
                <button class="btn btn-small uppercase" onclick="logout()">Logout</button>
            </div>
            
            <form id="artworkForm">
                <input type="hidden" id="editingId" value="">
                <div class="form-group">
                    <label for="title" class="uppercase">Artwork Title</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="artist" class="uppercase">Artist Name</label>
                    <input type="text" id="artist" required>
                </div>
                <div class="form-group">
                    <label for="year" class="uppercase">Year</label>
                    <input type="text" id="year" required>
                </div>
                <div class="form-group">
                    <label for="dimensions" class="uppercase">Dimensions</label>
                    <input type="text" id="dimensions" placeholder="e.g., 24 √ó 36 in">
                </div>
                <div class="form-group">
                    <label for="medium" class="uppercase">Medium</label>
                    <input type="text" id="medium" placeholder="e.g., Oil on canvas">
                </div>
                <div class="form-group">
                    <label for="price" class="uppercase">Price (Optional)</label>
                    <input type="text" id="price" placeholder="e.g., $5,000">
                </div>
                <div class="form-group">
                    <label for="orientation" class="uppercase">Orientation</label>
                    <select id="orientation" required>
                        <option value="landscape">Landscape (4:3)</option>
                        <option value="portrait">Portrait (3:4)</option>
                        <option value="square">Square (1:1)</option>
                        <option value="panoramic">Panoramic (16:9)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="uppercase">Artwork Images</label>
                    <div style="border: 2px dashed #e0e0e0; padding: 30px; text-align: center; cursor: pointer;" onclick="document.getElementById('imageUpload').click()">
                        <input type="file" id="imageUpload" style="display: none;" accept="image/*" multiple>
                        <div class="uppercase" style="font-size: 13px; color: #999;">Click to upload images</div>
                    </div>
                    <div id="imagePreview" style="margin-top: 15px;"></div>
                </div>
                <button type="submit" class="btn uppercase">Add Artwork</button>
            </form>
            
            <div id="aboutForm" style="border-top: 1px solid #f0f0f0; padding-top: 30px; margin-top: 30px;">
                <h4 class="uppercase" style="font-size: 12px; color: #666; margin-bottom: 20px;">About Section</h4>
                <div class="form-group">
                    <label for="aboutText" class="uppercase">About Text</label>
                    <textarea id="aboutText" rows="8"></textarea>
                </div>
                <button class="btn uppercase" onclick="saveAbout()">Update About</button>
            </div>
        </div>
    </div>

    <!-- Generic Modal Template -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent">
            <button class="close-modal" onclick="closeModal()">√ó</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab-write" id="fabWrite" onclick="openWriteArticle()" style="display: none;">‚úé</button>

    <main>
        <div class="container">
            <div class="gallery-controls" id="galleryControls" style="display: none;">
                <div style="display: flex; gap: 20px; align-items: center; flex: 1;">
                    <div style="position: relative;">
                        <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #9ca3af;">üîç</span>
                        <input type="text" class="search-input uppercase" id="searchInput" placeholder="Search artworks...">
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <select class="filter-select uppercase" id="artistFilter">
                            <option value="">Artists</option>
                        </select>
                        <select class="filter-select uppercase" id="yearFilter">
                            <option value="">Years</option>
                        </select>
                        <select class="filter-select uppercase" id="mediumFilter">
                            <option value="">Mediums</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div class="uppercase" style="font-size: 11px; color: #6b7280;"><span id="resultNumber">0</span> pieces</div>
                    <button class="btn btn-small uppercase" onclick="clearFilters()">Clear</button>
                </div>
            </div>
            <div class="gallery-grid" id="galleryGrid">
                <div style="text-align: center; padding: 60px; color: #6b7280;">Loading collection...</div>
            </div>
        </div>
    </main>

    <section id="about" class="about-section">
        <div class="container">
            <div class="about-content">
                <h2 class="uppercase" style="font-size: 13px; font-weight: 500; color: #6b7280; margin-bottom: 40px; letter-spacing: 2px;">About</h2>
                <div id="aboutContent" style="font-size: 18px; color: #4b5563; line-height: 1.8; text-align: left;">
                    <p>Welcome to the VonMesser Collection, a carefully curated assembly of contemporary and classical works that explore the intersection of traditional artistry and modern expression.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="contact-section">
        <div class="container">
            <div class="contact-content">
                <h2 class="uppercase" style="font-size: 13px; font-weight: 500; color: #6b7280; margin-bottom: 40px; letter-spacing: 2px;">Contact</h2>
                <p style="font-size: 16px; color: #4b5563; margin-bottom: 40px;">Interested in learning more about the VonMesser Collection?</p>
                <a href="mailto:flex@vonmesser.xyz" class="uppercase" style="color: #1f2937; text-decoration: none; font-size: 13px; font-weight: 500; padding: 15px 0; border-bottom: 2px solid #1f2937;">flex@vonmesser.xyz</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p class="uppercase" style="font-size: 10px; color: #9ca3af;">&copy; 2024 VonMesser Collection</p>
        </div>
    </footer>

    <script>
        // Initialize
        const supabase = window.supabase.createClient(
            'https://qqkshpkbfixeyusqpsou.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxa3NocGtiZml4ZXl1c3Fwc291Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5Mjc1ODksImV4cCI6MjA2NDUwMzU4OX0.EhAV5EvXDIRPJcp3ipBSqqo6xY6rh8Jghe__XZ4659U'
        );

        // State
        let state = {
            artworks: [],
            filtered: [],
            currentUser: null,
            currentPage: 'main',
            currentCollection: null,
            modalData: null,
            articles: [],
            curators: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadData();
            setupEventListeners();
        });

        // Auth Functions
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            const curatorData = sessionStorage.getItem('curator');
            
            if (session || curatorData) {
                state.currentUser = session?.user || JSON.parse(curatorData);
                showAdminContent();
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) return alert('Please fill all fields');

            try {
                // Try admin login first
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                
                if (error) {
                    // Try curator login
                    const { data: curator } = await supabase
                        .from('curators')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();
                    
                    if (curator) {
                        state.currentUser = curator;
                        sessionStorage.setItem('curator', JSON.stringify(curator));
                        showAdminContent();
                        alert(`Welcome, ${curator.name}!`);
                    } else {
                        throw new Error('Invalid credentials');
                    }
                } else {
                    state.currentUser = data.user;
                    showAdminContent();
                    alert('Login successful!');
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        async function logout() {
            await supabase.auth.signOut();
            sessionStorage.removeItem('curator');
            state.currentUser = null;
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
            toggleAdmin();
            renderGallery();
        }

        function showAdminContent() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminContent').style.display = 'block';
            document.getElementById('userEmail').textContent = state.currentUser.email || state.currentUser.name;
            document.getElementById('panelTitle').textContent = state.currentUser.name ? 'Curator Panel' : 'Admin Panel';
            
            // Show/hide about form based on user type
            document.getElementById('aboutForm').style.display = state.currentUser.name ? 'none' : 'block';
        }

        // Data Functions
        async function loadData() {
            const table = state.currentPage === 'curator' ? 'curator_artworks' : 
                          state.currentPage === 'curators-corner' ? 'articles' : 'artworks';
            
            try {
                let query = supabase.from(table).select('*');
                
                if (state.currentPage === 'curator' && state.currentCollection) {
                    query = query.eq('collection_id', state.currentCollection);
                }
                
                query = query.order('display_order', { ascending: true, nullsLast: true })
                            .order('created_at', { ascending: false });
                
                const { data, error } = await query;
                if (error) throw error;
                
                if (state.currentPage === 'curators-corner') {
                    state.articles = data || [];
                    renderArticles();
                } else {
                    state.artworks = data || [];
                    state.filtered = [...state.artworks];
                    populateFilters();
                    renderGallery();
                }
                
                // Load curators
                const { data: curatorsData } = await supabase
                    .from('curators')
                    .select('*')
                    .eq('status', 'approved');
                state.curators = curatorsData || [];
                
                // Load about
                const { data: aboutData } = await supabase
                    .from('about')
                    .select('content')
                    .limit(1);
                if (aboutData?.length) {
                    document.getElementById('aboutContent').innerHTML = 
                        aboutData[0].content.split('\n').map(p => `<p>${p}</p>`).join('');
                    document.getElementById('aboutText').value = aboutData[0].content;
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Form Handling
        document.getElementById('artworkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!state.currentUser) return;

            const formData = {
                title: document.getElementById('title').value,
                artist: document.getElementById('artist').value,
                year: document.getElementById('year').value,
                dimensions: document.getElementById('dimensions').value,
                medium: document.getElementById('medium').value,
                price: document.getElementById('price').value,
                orientation: document.getElementById('orientation').value,
                images: []
            };

            // Handle images
            const files = document.getElementById('imageUpload').files;
            if (files.length > 0) {
                for (let file of files) {
                    formData.images.push(await compressImage(file));
                }
            } else if (document.getElementById('editingId').value) {
                const existing = state.artworks.find(a => a.id === document.getElementById('editingId').value);
                formData.images = existing?.images || [];
            }

            try {
                const table = state.currentPage === 'curator' ? 'curator_artworks' : 'artworks';
                const editId = document.getElementById('editingId').value;
                
                if (state.currentPage === 'curator') {
                    formData.collection_id = state.currentCollection;
                    formData.curator_id = state.currentUser.id;
                }
                
                if (editId) {
                    await supabase.from(table).update(formData).eq('id', editId);
                } else {
                    await supabase.from(table).insert([formData]);
                }
                
                alert('Artwork saved!');
                document.getElementById('artworkForm').reset();
                loadData();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        // Image Compression
        function compressImage(file, maxWidth = 800) {
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        let { width, height } = img;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        // Gallery Rendering
        function renderGallery() {
            const grid = document.getElementById('galleryGrid');
            const isAdmin = state.currentUser && toggleAdmin.open;
            
            if (!state.filtered.length) {
                grid.innerHTML = `<div style="text-align: center; padding: 120px 20px; color: #6b7280;">
                    <h3 class="uppercase">No Artworks Yet</h3>
                    <p>Add your first artwork using the admin panel.</p>
                </div>`;
                return;
            }

            grid.innerHTML = state.filtered.map(artwork => `
                <div class="artwork-card" onclick="openArtwork('${artwork.id}')">
                    <div class="artwork-image ${artwork.orientation}">
                        <img src="${artwork.images?.[0] || ''}" alt="${artwork.title}">
                        ${isAdmin ? `
                            <div class="admin-controls">
                                <button class="admin-btn" onclick="event.stopPropagation(); editArtwork('${artwork.id}')">‚úé</button>
                                <button class="admin-btn" onclick="event.stopPropagation(); deleteArtwork('${artwork.id}')">√ó</button>
                            </div>
                        ` : ''}
                    </div>
                    <div class="artwork-info">
                        <div class="artwork-title uppercase">${artwork.title}</div>
                        <div class="artwork-details uppercase">
                            <div class="artwork-artist">${artwork.artist}</div>
                            <div>${artwork.year}</div>
                            ${artwork.medium ? `<div style="margin-top: 3px;">${artwork.medium}</div>` : ''}
                            ${artwork.price ? `<div class="artwork-price">${artwork.price}</div>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            setTimeout(() => {
                document.querySelectorAll('.artwork-card').forEach((card, i) => {
                    setTimeout(() => card.classList.add('animate-in'), i * 50);
                });
            }, 10);
        }

        function renderArticles() {
            const grid = document.getElementById('galleryGrid');
            document.getElementById('fabWrite').style.display = 'flex';
            
            grid.innerHTML = state.articles.map(article => `
                <div class="article-card" onclick="openArticle('${article.id}')">
                    <div class="article-header">
                        <div class="article-meta">
                            <img class="author-avatar" src="${article.author_avatar || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiPjxjaXJjbGUgY3g9IjI1IiBjeT0iMjUiIHI9IjI1IiBmaWxsPSIjZjBmMGYwIi8+PC9zdmc+'}" alt="">
                            <div class="author-info">
                                <h4 class="uppercase">${article.author_name}</h4>
                                <div class="uppercase" style="font-size: 11px; color: #6b7280;">${article.author_title || 'Contributor'}</div>
                            </div>
                        </div>
                        <h3 class="article-title uppercase">${article.title}</h3>
                        <p class="article-excerpt">${article.excerpt || article.content.substring(0, 150) + '...'}</p>
                        <div class="article-stats uppercase">
                            <span>${new Date(article.created_at).toLocaleDateString()}</span>
                            <span>${Math.ceil(article.content.split(' ').length / 200)} min read</span>
                        </div>
                    </div>
                </div>
            `).join('') || '<div style="text-align: center; padding: 120px;">No articles yet. Click the write button to create one.</div>';
        }

        // Modal Functions
        function openArtwork(id) {
            const artwork = state.artworks.find(a => a.id === id);
            if (!artwork) return;
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="background: #f8f8f8; padding: 40px; display: flex; align-items: center; justify-content: center; min-height: 450px;">
                    <img src="${artwork.images?.[0] || ''}" alt="${artwork.title}" style="max-width: 100%; max-height: 70vh; object-fit: contain;">
                </div>
                <div style="padding: 40px;">
                    <h3 class="uppercase" style="font-size: 20px; font-weight: 500; margin-bottom: 10px;">${artwork.title}</h3>
                    <div class="uppercase" style="font-size: 16px; color: #4b5563; margin-bottom: 15px;">${artwork.artist}</div>
                    <div style="font-size: 14px; color: #6b7280; line-height: 1.6;">
                        ${artwork.year}${artwork.dimensions ? ` ‚Ä¢ ${artwork.dimensions}` : ''}
                        ${artwork.medium ? `<br><em>${artwork.medium}</em>` : ''}
                    </div>
                    ${artwork.price ? `<div style="font-size: 18px; font-weight: 500; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">${artwork.price}</div>` : ''}
                </div>
            `;
            document.getElementById('modal').classList.add('show');
        }

        function openArticle(id) {
            const article = state.articles.find(a => a.id === id);
            if (!article) return;
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="padding: 50px; border-bottom: 1px solid #f0f0f0;">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                        <img src="${article.author_avatar || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiPjxjaXJjbGUgY3g9IjMwIiBjeT0iMzAiIHI9IjMwIiBmaWxsPSIjZjBmMGYwIi8+PC9zdmc+'}" alt="" style="width: 60px; height: 60px; border-radius: 50%;">
                        <div>
                            <h3 class="uppercase">${article.author_name}</h3>
                            <p class="uppercase" style="font-size: 12px; color: #6b7280;">${article.author_title || 'Contributor'}</p>
                        </div>
                    </div>
                    <h1 class="uppercase" style="font-size: 32px; font-weight: 500; line-height: 1.2;">${article.title}</h1>
                </div>
                <div style="padding: 40px 50px; font-size: 16px; line-height: 1.7; color: #374151;">
                    ${article.content}
                    ${article.images?.length ? `<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                        ${article.images.map(img => `<img src="${img}" style="width: 100%; border-radius: 8px;">`).join('')}
                    </div>` : ''}
                </div>
            `;
            document.getElementById('modal').classList.add('show');
        }

        function openWriteArticle() {
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="padding: 40px;">
                    <h3 class="uppercase" style="text-align: center; margin-bottom: 30px;">Write Article</h3>
                    <form id="articleForm">
                        <div class="form-group">
                            <label class="uppercase">Author Name</label>
                            <input type="text" id="authorName" required>
                        </div>
                        <div class="form-group">
                            <label class="uppercase">Title</label>
                            <input type="text" id="articleTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="uppercase">Excerpt</label>
                            <textarea id="articleExcerpt" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="uppercase">Content</label>
                            <div class="rich-editor">
                                <div class="editor-toolbar">
                                    <button type="button" class="editor-btn" onclick="formatText('bold')">Bold</button>
                                    <button type="button" class="editor-btn" onclick="formatText('italic')">Italic</button>
                                    <button type="button" class="editor-btn" onclick="formatText('formatBlock', 'h2')">Heading</button>
                                </div>
                                <div class="editor-content" id="articleContent" contenteditable="true"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn uppercase">Publish Article</button>
                    </form>
                </div>
            `;
            
            document.getElementById('modal').classList.add('show');
            
            document.getElementById('articleForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const data = {
                    author_name: document.getElementById('authorName').value,
                    title: document.getElementById('articleTitle').value,
                    excerpt: document.getElementById('articleExcerpt').value,
                    content: document.getElementById('articleContent').innerHTML
                };
                
                try {
                    await supabase.from('articles').insert([data]);
                    alert('Article published!');
                    closeModal();
                    loadData();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            });
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        // Editor Functions
        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('articleContent')?.focus();
        }

        // Artwork Management
        function editArtwork(id) {
            const artwork = state.artworks.find(a => a.id === id);
            if (!artwork) return;
            
            document.getElementById('editingId').value = id;
            document.getElementById('title').value = artwork.title;
            document.getElementById('artist').value = artwork.artist;
            document.getElementById('year').value = artwork.year;
            document.getElementById('dimensions').value = artwork.dimensions || '';
            document.getElementById('medium').value = artwork.medium || '';
            document.getElementById('price').value = artwork.price || '';
            document.getElementById('orientation').value = artwork.orientation;
            document.querySelector('#artworkForm button[type="submit"]').textContent = 'Update Artwork';
        }

        async function deleteArtwork(id) {
            if (!confirm('Delete this artwork?')) return;
            
            try {
                const table = state.currentPage === 'curator' ? 'curator_artworks' : 'artworks';
                await supabase.from(table).delete().eq('id', id);
                loadData();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Filter Functions
        function populateFilters() {
            if (!state.artworks.length) {
                document.getElementById('galleryControls').style.display = 'none';
                return;
            }
            
            document.getElementById('galleryControls').style.display = 'flex';
            
            const artists = [...new Set(state.artworks.map(a => a.artist))].sort();
            const years = [...new Set(state.artworks.map(a => a.year))].sort().reverse();
            const mediums = [...new Set(state.artworks.map(a => a.medium).filter(Boolean))].sort();
            
            populateSelect('artistFilter', artists);
            populateSelect('yearFilter', years);
            populateSelect('mediumFilter', mediums);
        }

        function populateSelect(id, options) {
            const select = document.getElementById(id);
            select.innerHTML = select.querySelector('option').outerHTML;
            options.forEach(opt => {
                select.innerHTML += `<option value="${opt}">${opt}</option>`;
            });
        }

        function filterArtworks() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const artist = document.getElementById('artistFilter').value;
            const year = document.getElementById('yearFilter').value;
            const medium = document.getElementById('mediumFilter').value;
            
            state.filtered = state.artworks.filter(a => {
                return (!search || a.title.toLowerCase().includes(search) || a.artist.toLowerCase().includes(search)) &&
                       (!artist || a.artist === artist) &&
                       (!year || a.year === year) &&
                       (!medium || a.medium === medium);
            });
            
            document.getElementById('resultNumber').textContent = state.filtered.length;
            renderGallery();
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('artistFilter').value = '';
            document.getElementById('yearFilter').value = '';
            document.getElementById('mediumFilter').value = '';
            filterArtworks();
        }

        // Navigation Functions
        function toggleAdmin() {
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('open');
            toggleAdmin.open = panel.classList.contains('open');
            renderGallery();
        }

        function returnToMain() {
            state.currentPage = 'main';
            state.currentCollection = null;
            document.querySelector('.tagline').textContent = 'Art Leads Culture';
            document.getElementById('fabWrite').style.display = 'none';
            loadData();
        }

        async function showCuratorsCorner() {
            state.currentPage = 'curators-corner';
            document.querySelector('.tagline').textContent = 'CURATORS CORNER';
            document.getElementById('galleryControls').style.display = 'none';
            loadData();
        }

        async function showAllCurators() {
            state.currentPage = 'browse-curators';
            document.querySelector('.tagline').textContent = 'GUEST CURATORS';
            document.getElementById('galleryControls').style.display = 'none';
            
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = state.curators.map(curator => `
                <div class="artwork-card" onclick="showCuratorProfile('${curator.id}')">
                    <div class="artwork-image square">
                        <img src="${curator.profile_image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9IiNmOGY4ZjgiLz48L3N2Zz4='}" alt="${curator.name}">
                    </div>
                    <div class="artwork-info">
                        <div class="artwork-title uppercase">${curator.name}</div>
                        <div class="artwork-details uppercase">
                            <div class="artwork-artist">Curator</div>
                        </div>
                    </div>
                </div>
            `).join('') || '<div style="text-align: center; padding: 120px;">No curators yet.</div>';
        }

        async function showCuratorProfile(curatorId) {
            const { data: collections } = await supabase
                .from('curator_collections')
                .select('*')
                .eq('curator_id', curatorId)
                .limit(1);
            
            if (collections?.length) {
                state.currentPage = 'curator';
                state.currentCollection = collections[0].id;
                const curator = state.curators.find(c => c.id === curatorId);
                document.querySelector('.tagline').textContent = curator.name.toUpperCase();
                loadData();
            }
        }

        function showFeaturedCurator() {
            if (state.curators.length) showCuratorProfile(state.curators[0].id);
        }

        function showCuratorApplication() {
            alert('Application feature coming soon!');
        }

        function toggleCuratorAuth() {
            alert('Curator login available through main admin panel');
            toggleAdmin();
        }

        async function saveAbout() {
            const content = document.getElementById('aboutText').value;
            try {
                await supabase.from('about').upsert([{ id: 1, content }]);
                document.getElementById('aboutContent').innerHTML = 
                    content.split('\n').map(p => `<p>${p}</p>`).join('');
                alert('About section updated!');
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Event Listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', filterArtworks);
            document.getElementById('artistFilter').addEventListener('change', filterArtworks);
            document.getElementById('yearFilter').addEventListener('change', filterArtworks);
            document.getElementById('mediumFilter').addEventListener('change', filterArtworks);
            
            document.getElementById('imageUpload').addEventListener('change', function() {
                const preview = document.getElementById('imagePreview');
                preview.innerHTML = `Selected ${this.files.length} image(s)`;
            });
            
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape' && document.getElementById('modal').classList.contains('show')) {
                    closeModal();
                }
            });
        }
    </script>
</body>
</html>
